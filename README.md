# ML_v1: Semantic Segmentation with DeepLabV3

Этот проект реализует задачу семантической сегментации изображений с использованием модели DeepLabV3-ResNet50. Проект включает кастомный датасет, построенный по формату COCO, и предоставляет скрипты для обучения и инференса модели. Проект оптимизирован для работы с GPU (CUDA).

## Репозиторий

Репозиторий находится по адресу:  
[https://github.com/AlexanderMalach/ml_v1.git](https://github.com/AlexanderMalach/ml_v1.git)

## Структура проекта

```plaintext
ml_v1/
├── checkpoints/                # Сохранённые модели (чекпоинты)
├── data/                       # Директория с данными
│   ├── images/                # Изображения (например, Test, Train)
│   └── annotations/           # Аннотации в формате COCO (например, instances_Test.json)
├── logs/                       # Логи обучения и работы проекта
├── models/
│   └── deeplabv3.py            # Определение модели DeepLabV3-ResNet50
├── src/
│   ├── config.py               # Файл с настройками (пути, гиперпараметры, устройство)
│   ├── datasets/
│   │   └── custom_dataset.py   # Кастомный датасет для семантической сегментации (COCO)
│   ├── inference/
│   │   └── inf_2.py            # Скрипт инференса (применение модели на изображениях)
│   ├── training/
│   │   └── train.py            # Скрипт обучения модели
│   └── utils/
│       └── logger.py           # Модуль для логирования
├── requirements.txt            # Зависимости проекта
└── README.md                   # Это описание проекта


## Установка

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/AlexanderMalach/ml_v1.git
   cd ml_v1
   ```

2. **Создайте и активируйте виртуальное окружение (рекомендуется):**

   ```bash
   python -m venv venv
   source venv/bin/activate   # Linux/MacOS
   venv\Scripts\activate      # Windows
   ```

3. **Установите зависимости:**

   Убедитесь, что у вас установлены драйверы NVIDIA и подходящая версия CUDA. Команды для установки зависимостей:
   
   ```bash
   pip install -r requirements.txt
   ```

   Если у вас другая версия CUDA, откройте файл `requirements.txt` и замените суффикс (например, `cu113`) на нужное значение (например, `cu116` для CUDA 11.6). Для подбора корректных версий воспользуйтесь [PyTorch Get Started](https://pytorch.org/get-started/locally/).

## Использование

### Обучение модели

Запустите скрипт обучения:

```bash
python src/training/train.py
```

Логи сохраняются в папке `logs/`, а чекпоинты модели – в папке `checkpoints/`.

### Инференс

Для применения модели на новых изображениях используйте скрипт инференса:

```bash
python src/inference/inf_2.py
```

Скрипт загрузит лучший чекпоинт из `checkpoints/` и сохранит предсказанную маску в файл `pred_mask.png`.

## Конфигурация

Основные параметры (пути, гиперпараметры, устройство) заданы в файле `src/config.py`. При необходимости вы можете изменить их для адаптации проекта под свои данные и условия обучения.

## Зависимости

Проект использует следующие библиотеки:
- **PyTorch** (с поддержкой CUDA)
- **torchvision**
- **albumentations**
- **opencv-python**
- **tensorboard**
- **pycocotools**
- **Pillow**
- **numpy**

Убедитесь, что у вас установлены подходящие драйверы NVIDIA и версия CUDA, соответствующая версии PyTorch, указанной в файле `requirements.txt`.

Чтобы подобрать правильные версии PyTorch и torchvision для вашей версии CUDA, выполните следующие шаги:

1. **Проверьте версию CUDA на вашем компьютере:**

   - Если у вас установлен драйвер NVIDIA, можно выполнить команду в терминале:
     ```bash
     nvcc --version
     ```
     или
     ```bash
     nvidia-smi
     ```
     Эти команды покажут, какая версия CUDA доступна на вашем устройстве.

2. **Перейдите на официальный сайт PyTorch:**

   Откройте [PyTorch Get Started](https://pytorch.org/get-started/locally/). Здесь можно указать:
   - Операционную систему,
   - Пакет (pip или conda),
   - Язык (Python),
   - Версию CUDA (например, CUDA 11.6, CUDA 11.3 и т.д.).

   После выбора параметров сайт сгенерирует корректную команду для установки, где версия пакетов будет соответствовать вашему оборудованию.

3. **Обновите файл requirements.txt:**

   Например, если у вас CUDA 12.8, команда может выглядеть так:
   ```plaintext
   torch>=1.12.0+cu128 -f https://download.pytorch.org/whl/torch_stable.html
   torchvision>=0.13.0+cu128 -f https://download.pytorch.org/whl/torch_stable.html
   ```
   Если у вас другая версия, просто замените часть `cu128` на нужное значение (например, `cu116`).

Таким образом, вы удостоверитесь, что устанавливаете версии библиотек, оптимизированные для вашей версии CUDA и оборудования.
